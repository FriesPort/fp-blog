---
title: "NFS挂载"
date: 2026-02-28T12:09:34+08:00
draft: false
description: ""
showHero: false
slug: "nfs-mount"
---

## 前言

NFS硬盘允许服务器将局域网的设备挂载到指定目录下，像访问本地目录一样使用局域网的存储。

定义以下名词缩写：
- cal：计算设备 calculate
- sto：存储设备 storage
- cnt：容器 container

绿联NAS的配置如下：
- 服务器地址：<cal-ip>
- 权限：读写
- Squash：所有用户映射为admin
- 安全性：AUTH_SYS
- 允许异步：True
- 允许来自非特权端口的连接：True

## 挂载到本地路径

如果想测试NFS是否配置得当，可以先测试一下功能。

为了防止未挂载时直接写到本地硬盘，这里单独创建一个挂载点，无法读写任何东西，如果未挂载成功时尝试对此目录进行读写会报错。

安装nfs驱动

```bash
sudo apt install nfs-common
```

配置挂载路径

```bash
showmount -e <sto-ip>
sudo mkdir -p /mnt/nfs
# 设置挂载点为“禁区”，如果 NFS 没挂上，任何人都写不进去
sudo chown root:root /mnt/nfs
sudo chmod 000 /mnt/nfs
```

使用 `mount` 命令将远程目录挂载上去。挂载成功后，`/mnt/nfs` 的权限会被 NAS 上的权限覆盖。

```bash
sudo mount -t nfs -o rw,nolock <sto-ip>:<sto-path> /mnt/nfs
```

卸载硬盘

```bash
sudo umount /mnt/nfs
```

## 设置开机自动挂载

编辑 `/etc/fstab` 文件，确保重启后依然生效：

```bash
# 编辑文件
sudo nano /etc/fstab

```

添加以下行

```sh
<sto-ip>:<sto-path>  <cal-path>  nfs  rw,tcp,nolock,soft,timeo=30,retrans=2,_netdev  0  0
```

## 挂载到docker

**compose配置**

```yaml
volumes:
  nfsvolume:
    driver: local
    driver_opts:
      type: nfs
      device: ":<sto-path>"
      o: "addr=<sto-ip>"
```

例如我要挂载nas的指定文件夹

```yaml
volumes:
  teable-nfs:
    driver: local
    driver_opts:
      type: nfs
      o: "addr=<ip>,rw,nolock,soft,nfsvers=3,noresvport"
      device: ":/volume1/docker/pgsql"
```

**特殊处理**

pgsql使用999用户来读写目录，需要修改路径拥有者为999

```bash
sudo chown -R 999:999 /volume1/docker/pgsql
```

## 参考文献

[docker nfs 文档](https://docs.docker.com/engine/storage/volumes#create-a-service-which-creates-an-nfs-volume)
